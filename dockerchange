ARG BASE_REGISTRY=fmk.nexus.onefiserv.net
ARG BASE_IMAGE=fmk/node/node18
ARG BASE_TAG=FMK-10-25-23
ARG FMK_BASE_IMAGE=${BASE_REGISTRY}/${BASE_IMAGE}:${BASE_TAG}

FROM ${FMK_BASE_IMAGE}

USER root

WORKDIR /home/node

RUN cat .npmrc

# Install apigeelint globally (for CLI usage)
RUN npm install -g apigeelint

# Install apigeelint locally as dev dependency if required by your project
RUN npm install apigeelint --save-dev

# Copy your ftsPlugin folder into expected location
COPY ftsPlugin/ /home/node/apigeelint/ftsPlugin/

# Combine cd + npm i in one RUN statement to install inside apigeelint folder
RUN cd apigeelint && npm install

# If you need to symlink plugins, uncomment and adjust these lines:
# RUN ln -s ftsPlugin /usr/local/lib/node_modules/apigeelint/node_modules/
# RUN ln -s externalPlugins /usr/local/lib/node_modules/apigeelint/node_modules/

# Optional chown if running as non-root later
# RUN chown node:node /home/node/externalPlugins/ && chown node:node /home/node/ftsPlugin/

# Update PATH to include apigeelint node_modules binaries
ENV NODE_PATH="${PATH}:/home/node/apigeelint/node_modules:/home/lint_module"

# Final CMD should be your desired entrypoint or a default echo
CMD ["echo", "FISERV APIM Apigeelint image"]