build_and_push_image:
  stage: build_and_push
  tags:
    - apihub-shell-prod
  script:
    - echo "Logging in to Nexus Docker registry..."
    - echo "$NEXUS_REPO_PASS" | docker login -u $NEXUS_REPO_USER --password-stdin $NEXUS_REGISTRY
    - echo "Building Docker image with apigeelint pre-installed..."
    - docker build \
        --build-arg APIGEE_LINT_GIT_URL=$APIGEE_LINT_GIT_URL \
        --build-arg APIGEE_LINT_BRANCH=$APIGEE_LINT_BRANCH \
        -t $FULL_IMAGE_NAME .
    - echo "Pushing Docker image to Nexus..."
    - docker push $FULL_IMAGE_NAME
  rules:
    - changes:
        - "**/*"
